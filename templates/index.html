<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.0/css/bootstrap.min.css" crossorigin="anonymous">

	<title>Tester for Logger </title>
</head>
<body style="background-color: #f5f5f5; font-size: .85em;">
	<div class="container-fluid">
  	<div class="row">
  		<div class="col-12">
        <h1>REST logging interface</h1>
      </div>
    </div>
  </div>
	<div class="container-fluid">
		<div class="row">
			<div class="col-12">
				<div class="card mt-4 mb-4">
					<div class="card-header" style="height: 0px;padding:.1rem; background-color: #555555;">
					</div>

					<div class="card-body">
						<div class="row">
							<div class="col-6">
								<div class="row" style="border-bottom: 1px solid grey; margin-bottom: .5em; padding-bottom:.5em;">
									<!-- <div class="col-2"><p style="line-height: 31px;""><b>SEND</b></p></div> -->
									<div class="col-12">
										<p>
											<span id ="urlSend" style="line-height: 31px;"></span>
											<input type="text" class="form-control form-control-sm" id="sendName" value="test" style="width: 100px; margin-left: 2px; padding-left: 3px; display: inline;">
										</p>

										<textarea class="form-control form-control-sm" id="JSONtoSend" rows="5" style="font-family: monospace; resize: none;" ></textarea>
										<button id ="btnSend" style="margin-top: .5em;" class="btn btn-info btn-sm float-right">Send</button>
									</div>
								</div>

								<div class="row" style="border-bottom: 1px solid grey; margin-bottom: .5em; padding-bottom:.5em;">
									<!-- <div class="col-2">
										<p style="line-height: 31px;"">
											<b>READ</b>
										</p>
									</div> -->
									<div class="col-12">
										<p>
                      <div style="display: inline-block; margin-bottom: .5em; margin-right: .5em;">
											<span id ="urlRead" style="line-height: 31px;"></span>
											<input type="text" class="form-control form-control-sm" id="readName" value="test" style="width: 100px; margin-left: 2px; padding-left: 3px; display: inline;">
                    </div>
											<button id ="btnRead" style="margin-top: .0em;" class="btn btn-info btn-sm float-right">Read</button>
										</p>
									</div>
								</div>

								<div class="row" style="border-bottom: 1px solid grey; margin-bottom: .5em; padding-bottom:.5em;">
									<!-- <div class="col-2">
										<p style="line-height: 31px;"">
											<b>DOWNLOAD</b>
										</p>
									</div> -->
									<div class="col-12">
										<p>
                      <div style="display: inline-block; margin-bottom: .5em; margin-right: .5em;">
											<span id ="urlDownload" style="line-height: 31px;"></span>
											<input type="text" class="form-control form-control-sm" id="downloadName" value="test" style="width: 100px; margin-left: 2px; padding-left: 3px; display: inline;">
                    </div>
											<button id ="btnDownload" style="margin-top: .0em;" class="btn btn-info btn-sm float-right">Download</button>
										</p>
									</div>
								</div>


								<div class="row" style="margin-bottom: .5em; padding-bottom:.5em;">
									<!-- <div class="col-2">
										<p style="line-height: 31px;"">
											<b>DELETE</b>
										</p>
									</div> -->
									<div class="col-12">
										<p>
											<div style="display: inline-block; margin-bottom: .5em; margin-right: .5em;">
                      <span id ="urlDelete" style="line-height: 31px;"></span>
											<input type="text" class="form-control form-control-sm" id="deleteName" value="test" style="width: 100px; margin-left: 2px; padding-left: 3px; display: inline;">
											<br>Password: <input type="text" class="form-control form-control-sm" id="password" value="ENTER PASSWORD" style="width: 150px; margin-left: 2px; padding-left: 3px; display: inline;"></div><button id ="btnDelete" style="margin-top: .0em;" class="btn btn-info btn-sm float-right">Delete</button>
										</p>
									</div>
								</div>
							</div>

							<div class="col-6">

								<pre style="font-size: .8em;"><code class="json" id="output"> </code></pre>
							</div>
						</div>
					</div>
    </div>

    <div class='card mt-4 mb-4'>
    <div class='card-body'>
                <h2 id="importantinformation">Important information</h2>
          <div class="row">
    <div class="col-12">
        <ol>
        <li>please check your log id is not already in use by someone else!!!</li>
        <li>do not share the password</li>
        </ol>
    </div>
  </div>
</div>
</div>

    <div class='card mt-4 mb-4'>
      
    <div class='card-body'>
                    <h2 id="javascriptcodetousethelogger">Javascript code to use the logger</h2>
          <div class="row">
    <div class="col-12">

        <pre style="font-size: .8em;"><code class="javascript" id="code"> function sendlog(mess_dict, callback) {
            if (typeof callback === 'undefined') {
                callback = function() {};
            }
            var dict = {
                'worker_id': '12312',
                'job_id': '12321',
                'local_time': Date()
            };
            dict = $.extend(dict, mess_dict);
            jQuery.ajax({
              url: 'https://fast-logging.herokuapp.com/records/add/test',
              type: 'POST',
              contentType: 'application/json; charset=utf-8',
              dataType: 'json',
              data: JSON.stringify(dict),
              success: callback
            });
        }
a = sendlog({'a':'2'},function(data){console.log(data)})
</code></pre>
        
      </div>
    </div>
  </div>
</div>

    <div class='card mt-4 mb-4'>
    <div class='card-body'>
             <h2 id="pandas">Pandas</h2>
          <div class="row">
    <div class="col-12">
      Remember to use <code class='python'>pd.read_json('filename',lines=True)</code> if you want to load the log in pandas
    </div>
  </div>
</div>
					<div class="card-footer" style="height: 0px;padding:.1rem; background-color: #555555;">
						<div class="text-right"> by Eddy Maddalena and Alessandro Checco. Email: <a href="mailto:a.checco@sheffield.ac.uk">a.checco@sheffield.ac.uk</a>.<br></div>
					</div>
				</div>
			</div>
		</div>
    
	</div>

	

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
	<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>

	<script type="text/javascript">

		URL_DELETE 		= "https://fast-logging.herokuapp.com/records/delete/"
		URL_SEND		= "https://fast-logging.herokuapp.com/records/add/"
		URL_DOWNLOAD 	= "https://fast-logging.herokuapp.com/records/download/"
		URL_READ		= "https://fast-logging.herokuapp.com/records/get/"
		
		$("#urlSend").html(URL_SEND.replace("add", "<b>add</b>"))
		$("#urlDelete").html(URL_DELETE.replace("delete", "<b>delete</b>"))
		$("#urlRead").html(URL_READ.replace("get", "<b>get</b>"))
		$("#urlDownload").html(URL_DOWNLOAD.replace("download", "<b>download</b>"))

		json_to_server = {
			'name': "Alessandro",
			'occupation': "Sleeping"
		}

		$("#JSONtoSend").html(JSON.stringify(json_to_server))

		$("#result").hide();	


		$("#btnSend").click( function(){
			url = URL_SEND + $("#sendName").val()
			// json_obj = jQuery.parseJSON( $("#JSONtoSend").html() ) 

			// $("#JSONtoSend").val(JSON.stringify(json_to_server))
			// json_obj = jQuery.parseJSON( JSON.stringify( $("#JSONtoSend").val() ) )


			// json_obj = jQuery.parseJSON( $("#JSONtoSend").html()    )


			// $("#JSONtoSend").val(JSON.stringify(json_to_server))
			json_obj = jQuery.parseJSON( $("#JSONtoSend").val() )
			
			console.log( json_obj) 

			console.log("stringifato")

			console.log(JSON.stringify(json_obj, null, 4))


			jQuery.ajax({
				url: url,
				type: 'POST',
				contentType: 'application/json; charset=utf-8',
				dataType: 'json',
				data: JSON.stringify( json_obj  ),
				success: function(data){
					$("#output").html( JSON.stringify(json_obj, null, 4) ) 
					hljs.initHighlighting.called = false;
					hljs.initHighlighting();
				}
			});
		})

		$("#btnRead").click( function(){
			url = URL_READ + $("#readName").val()
			jQuery.ajax({
				url: url,
				type: 'GET',
				success: function(data){
					$("#output").html( JSON.stringify(data, null, 4) ) 
					// $("#output").html(data)
					hljs.initHighlighting.called = false;
					hljs.initHighlighting();
				}
			});
		});


		$("#btnDownload").click( function(){
			url = URL_DOWNLOAD + $("#downloadName").val()
			window.open(url, '_blank');
		})

		$("#btnDelete").click( function(){

			url = URL_DELETE + $("#deleteName").val()

			jQuery.ajax({
				url: url,
				type: 'POST',
				contentType: 'application/json; charset=utf-8',
				dataType: 'json',
				data: JSON.stringify({'password':$('#password').val()}),
				
				success: function(data){
					$("#output").html( JSON.stringify(data, null, 4) ) 
					hljs.initHighlighting.called = false;
					hljs.initHighlighting();
				}
			});
		});


	</script>
</body>


</html>
